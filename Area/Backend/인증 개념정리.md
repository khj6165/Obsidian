### 암호화 방식

![[Pasted image 20241202140559.png]]

### OAuth
OAuth는 인터넷 사용자들이 비밀번호를 제공하지 않고 다른 웹사이트 상의 자신들의 정보에 대해 웹사이트나 애플리케이션의 접근 권한을 부여할 수 있는 공통적인 수단으로서 사용되는, 접근 위임을 위한 개방형 표준이다. 

다른 서비스의 사용자 정보를 우리 서비스로 가져올 때 사용.
대칭키를 사용하고 IDP가 복호화 주체임

resource owner, client, resource server간의 정보 교환

client : id, secret key, resource server가 준 code 를 resource server에게 다시줌.
resource server가 resource owner가 맞는지 검증
맞으면 access token 을 resource server가 client에게 발급
client는 access token을 저장해놓고 resource server와 통신.

##### OAuth 구성요소
![[Pasted image 20250115164958.png]]

| 구분                   | 설명                                                                                                                                                                                                                                                                                                     |
| -------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| Resource Owner       | 웹 서비스를 이용하려는 유저, 자원(개인정보)을 소유하는 자, 사용자  <br>  <br>'Resource' 는 개인정보라고 생각하면 된다.                                                                                                                                                                                                                         |
| Client               | 자사 또는 개인이 만든 애플리케이션 서버  <br>  <br>클라이언트 라는 이름은 client가 Resource server에게 필요한 자원을 요청하고 응답하는 관계여서 그렇다.<br>                                                                                                                                                                                               |
| Authorization Server | 권한을 부여(인증에 사용할 아이템을 제공주는)해주는 서버다.  <br>  <br>사용자는 이 서버로 ID, PW를 넘겨 Authorization Code를 발급 받을 수 있다.  <br>Client는 이 서버로 Authorization Code을 넘겨 Token을 받급 받을 수 있다.<br>                                                                                                                                    |
| Resource Server      | 사용자의 개인정보를 가지고있는 애플리케이션 (Google, Facebook, Kakao 등) 회사 서버    <br>  <br>Client는 Token을 이 서버로 넘겨 개인정보를 응답 받을 수 있다.<br>                                                                                                                                                                                   |
| Access Token         | 자원에 대한 접근 권한을 Resource Owner가 인가하였음을 나타내는 자격증명<br>                                                                                                                                                                                                                                                     |
| Refresh Token        | Client는 Authorization Server로 부터 access token(비교적 짧은 만료기간을 가짐) 과 refresh token(비교적 긴 만료기간을 가짐)을 함께 부여 받는다.  <br>  <br>access token은 보안상 만료기간이 짧기 때문에 얼마 지나지 않아 만료되면 사용자는 로그인을 다시 시도해야한다.   <br>그러나 refresh token이 있다면 access token이 만료될 때 refresh token을 통해 access token을 재발급 받아 재 로그인 할 필요없게끔 한다.<br> |
**Client ID**

- 어플리케이션(서비스)을 식별하는 식별자ID를 의미한다.
- 다양한 서비스가 존재하는데, Resource Server 입장에서 어떤 서비스에게 제공할 것 인지 구분하는 ID를 의미한다.

**Client Secret**

- Client ID에 대한 비밀번호로 외부에 노출되면 안된다.
- ID의 PASSWORD라고 생각하면 된다.

**Authorized redirect URIs**

- Resource Server만 갖는 정보로, client에 권한을 부여하는 과정에서 나중에 Authorized code를 전달하는 통로다.
- 나중에 client <-> Resource Server 유효성 검사에서 이 redirect URIs도 체크되며 해당주소가 아닐 경우 Resource Server는 해당 client가 아니라고 판단한다.
- 즉, 예를들어 네이버 서버가 사용자의 개인정보를 콜백할 주소를 적는 곳이다.

**scope**

- Resource Server에서 사전에 사용 가능하도록 미리 정의한 기능
- 글 작성하기, ID알기, Email 알기, 캘린더 일정 입력하기 등등
- 페이스북이든 구글이든 로그인 되었다면, 그 서비스 안에서 사용할 수 있는 모든 기능
- openid를 scope에 추가하면 id token을 반환해준다.

출처: [https://inpa.tistory.com/entry/WEB-📚-OAuth-20-개념-💯-정리](https://inpa.tistory.com/entry/WEB-%F0%9F%93%9A-OAuth-20-%EA%B0%9C%EB%85%90-%F0%9F%92%AF-%EC%A0%95%EB%A6%AC) [Inpa Dev 👨‍💻:티스토리]


보안적으로 안전한 sdk 도구를 사용해야함.
### OIDC
oauth2.0은 사실 인증을 위한게 아니라 자원을 가져오기 위한, 인가(권한)를 목적으로 하는 서비스이다. 그래서 OIDC는 인증 전용 프로토콜로, 최종적으로 ID Token을 제공한다.


Access Token은 인증되었음을 보장하지 않는다. ID Token이 사용자 인증을 증명함.
ID Token은 JWT로 표현되며 발급자가 개인키로 서명하여 토큰의 출처와 변조되지 않음을 보장.
어플리케이션은 공개키로 ID토큰을 검증한다. jwt를 디코드하면 클레임 안에 정보가 포함되어있다.
![[Pasted image 20250131133633.png]]
비대칭키를 사용하고 우리 서비스 측에서 복호화를 통해 사용자를 판단 가능.
구글 사용자 인증 정보
API키 : 
OAuth 클라이언트 ID : 특정 사용자의 구글 안에서의 정보 가져오기.
서비스 계정 키 : 

### Token 인증
**[서버 기반 vs 토큰 기반]**  
  
**_서버(세션) 기반 인증 시스템_**  
서버의 세션을 사용해 사용자 인증을 하는 방법으로 서버측(서버 램 or 데이터베이스)에서 사용자의 인증정보를 관리하는 것을 의미한다.  
그러다 보니, 클라이언트로부터 요청을 받으면 클라이언트의 상태를 계속에서 유지해놓고 사용한다.  
(Stateful) 이는 사용자가 증가함에 따라 성능의 문제를 일으킬 수 있으며 확장성이 어렵다는 단점을 지닌다.  
  
**_토큰 기반 인증 시스템_**  
이러한 단점을 극복하기 위해서 "토큰 기반 인증 시스템"이 나타났다.  
인증받은 사용자에게 토큰을 발급하고, 로그인이 필요한 작업일 경우 헤더에 토큰을 함께 보내 인증받은 사용자인지 확인한다.  
이는 서버 기반 인증 시스템과 달리 상태를 유지하지 않으므로 Stateless 한 특징을 가지고 있다.

- 사용자가 아이디와 비밀번호로 로그인을 한다.
- 서버 측에서 사용자(클라이언트)에게 **유일한 토큰**을 발급한다.
- 클라이언트는 서버 측에서 전달받은 토큰을 쿠키나 스토리지에 저장해 두고, 서버에 요청을 할 때마다 해당 토큰을 서HTTP 요청 헤더에 포함시켜 전달한다.
- 서버는 전달받은 토큰을 검증하고 요청에 응답한다.   
    토큰에는 요청한 사람의 정보가 담겨있기에 서버는 DB를 조회하지 않고 누가 요청하는지 알 수 있다.

출처: [https://inpa.tistory.com/entry/WEB-📚-JWTjson-web-token-란-💯-정리](https://inpa.tistory.com/entry/WEB-%F0%9F%93%9A-JWTjson-web-token-%EB%9E%80-%F0%9F%92%AF-%EC%A0%95%EB%A6%AC) [Inpa Dev 👨‍💻:티스토리]

토큰은 쿠키와 달리 서명을 사용하기 때문에 똑같이 헤더에 넣더라도 데이터 무결성을 보장받을 수 있다.

### saml 2.0 기반의 인증과정
![[Pasted image 20241125111153.png]]

![[Pasted image 20250305174528.png]]

### ADC(Application Default Credentials)

### 페더레이션

ID 페더레이션은 사용자를 인증하고 리소스에 대한 액세스 권한을 부여하는 데 필요한 정보를 전달하기 위한 두 당사자 간의 신뢰 시스템입니다. 이 시스템에서 ID 제공업체(IdP)는 사용자 인증을 담당하고, 서비스 또는 애플리케이션과 같은 서비스 제공업체(SP)는 리소스에 대한 액세스를 제어합니다. 서비스 제공업체는 관리 계약 및 구성에 따라 ID 제공업체가 사용자를 인증할 것이라고 신뢰하며, ID 제공업체가 제공한 사용자 정보에 의존합니다. ID 제공업체는 사용자를 인증한 후 서비스 제공업체에 어설션이라는 메시지를 보냅니다. 이 메시지에는 사용자의 로그인 이름과 서비스 제공업체가 사용자와의 세션을 설정하고 서비스 제공업체가 부여해야 하는 리소스 액세스 범위를 결정하는 데 필요한 기타 특성이 들어 있습니다. 페더레이션은 중앙 ID 제공업체 내에서 사용자를 중앙에서 관리하고 서비스 제공업체 역할을 하는 여러 애플리케이션 및 서비스에 대한 사용자의 액세스 권한을 관리하는 액세스 제어 시스템을 구축하는 일반적 접근 방식입니다.


